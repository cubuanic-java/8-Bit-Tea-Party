;8-Бит Чаепитие! 2021.
;Лицензия: Creative Commons.
;Платформа: 8086, VGA(256Kb).
;Инструменты: NASM.
;Модули: VGA-X,...
;Авторы: Данила Перов(peroff@protonmail.com).
;Быстродействие: примерное количество тактов для каждой процедуры.
;Память: процед_1 = N, процед_2 занимает М байт.
;Краткая история изменений:
;ДД.ММ.ГГ, И.И.: Короткое сообщение что добавлено, удалено или исправлено.

%include "VGA-X.ASM"            ;Директива включения заголовка для NASM.

;Полный комплект, при условии если всё ок, то до 13-20 ноября.
;Базовый вариант, через недельку-две-три, буква.



;Процедуры печати в экранную память режима Х, нашего 16-ти битного формата
;строк. Смотри файл string.asm для подробного описания формата.
;Использует дополнительно пару глобальных параметров: шрифт по умолчанию и
;текущие позиции вывода для удобства вызовов. Для старта можно взять пока
;системный шрифт ВГА адаптера. Его можно получить при вызове функции.
;Шрифт минимально черно-белый размеры были по умолчанию 8*8.


;Глобальные переменные и константы, когда будет доделано, то скинем их в
;общий файл библиотеки режима Х.


vx_cursor_x     dw 0000h        ;Левая точка позиции курсора, 0..319.
vx_cursor_y     dw 0000h        ;Верхняя точка позиции курсора, 0..239.
vx_font_addr    dd 00000000h    ;Полный адрес шрифта, смещение и сегмент.
vx_font_chars   dw 0000h        ;Количество символов в шрифте, лучше байт.
vx_font_char_b  db 00h          ;Количество байт на один символ.
vx_font_width   db 00h          ;Ширина символа в точках.
vx_font_height  db 00h          ;Высота символа в линиях.

;Если потребуются вспомогательные процедуры работы со шрифтом, то добавляй
;временно прямо сюда, если что подумаем позже об отдельном файле. VXFontLoad.


;Дополнительно, только если уже ниже процедуры реализованы.
;Всё по аналогии, только с учетом вывода в окно.
;Параметры пока подумаем, но главное, что бы вывод шел с ограничением
;относительно логического окна, а не экрана и плюс с разными дополнительными
;возможностями.

VXPrintStrWin:
        pushf
        popf
        ret


;Процедура печати грфической строки на экран в режиме Х, по координатам.
;Печать использует глобальные параметры по-умолчанию: позиция, шрифт и т.д.
;При выходе за пределы экрана, выходим тихо.
;Вход:
;AH     биты:
;0..2   масштабирование для символов, 1..8(сначала просто масштаб 1х);
;4      резерв
;5      печатать по одному символу, запомнить состояние и выйти, чтобы
;       уложится в один кадр;
;6      останавливать вывод при достижении конца горизонтального вывода;
;7      переносить или нет глобальные координаты печати;
;DS:BX  адрес строки;
;Выход: измененный видеобуффер в активной странице и если бит 7, то и курсор.

VXPrintString:
        pushf
        popf
        ret


;Процедура печати графического символа на экран в режим Х, по координатам.
;Пока что использовать шрифт и позицию глобальную, параметры шрифта так-же.
;После исполнения сдвгаем позицию слева направо на размер шрифта, если не
;влезает вправо, то переносим на слдующую строку, так же по размеру шрифта
;по вертикали.
;Вход:
;AL     символ для вывода;
;AH     биты:
;0..2   масштабирование для символа, 1..16(сначала просто масштаб 1х);
;5..7   резерв, здесь можно стиль вывода будет сделать, задержку, маску и т.д.
;Выход: измененный видеобуффер в активной странице.

VSPrintChar:
        pushf
        popf
        ret

